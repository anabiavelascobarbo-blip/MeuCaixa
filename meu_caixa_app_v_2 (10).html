<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Caixa</title>
<style>
body, html { margin:0; padding:0; font-family: 'Segoe UI', sans-serif; }
body { background:#e3f2fd; color:#333; overflow-x:hidden; }
header { background:#0d47a1; color:#fff; padding:16px; text-align:center; font-size:1.4em; }
.container { padding:16px; padding-bottom:90px; }
input, textarea, button, select { width:100%; padding:12px; margin:8px 0; border-radius:8px; border:1px solid #ccc; font-size:1em; }
textarea { resize:none; }
button { background:#1976d2; color:#fff; border:none; font-weight:bold; }
.card { background:#fff; border-radius:12px; padding:14px; margin:10px 0; box-shadow:0 4px 10px rgba(0,0,0,0.12); }
.nav { position:fixed; bottom:0; width:100%; background:#bbdefb; display:flex; overflow-x:auto; }
.nav button { flex:1; min-width:120px; padding:14px; border-radius:0; background:none; color:#0d47a1; font-weight:bold; }
.hide { display:none; }
.suggestion-list { background:#fff; border:1px solid #ccc; max-height:120px; overflow-y:auto; position:absolute; z-index:1000; width:calc(100% - 32px); }
.suggestion-item { padding:8px; cursor:pointer; }
.suggestion-item:hover { background:#eee; }
</style>
</head>
<body>
<header>Meu Caixa</header>

<!-- LOGIN -->
<div class="container" id="loginDiv">
<h2>Login</h2>
<input id="username" placeholder="Usuário">
<input id="password" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p id="loginMsg" style="color:red"></p>
</div>

<!-- APP -->
<div class="container hide" id="appDiv">

<!-- PANORAMA -->
<div id="panorama" class="screen">
<h2>Resumo</h2>
<div class="card">Total emprestado: R$ <span id="totEmp">0</span></div>
<div class="card">Total a receber: R$ <span id="totRec">0</span></div>
<div class="card">Total já recebido: R$ <span id="totPago">0</span></div>
<div class="card">Lucro geral: R$ <span id="lucro">0</span></div>
</div>

<!-- CLIENTES -->
<div id="clientes" class="screen hide">
<h2>Clientes</h2>
<input placeholder="Pesquisar cliente" oninput="filtrar(this.value)">
<div id="lista"></div>
</div>

<!-- ADICIONAR -->
<div id="add" class="screen hide">
<h2>Adicionar</h2>
<input id="nome" placeholder="Nome do cliente" required>
<input id="valor" type="number" placeholder="Valor emprestado" required>
<input id="dataEmp" type="date" required>
<input id="dataLim" type="date" required>
<textarea id="obs" placeholder="Observações"></textarea>
<button onclick="salvarCliente()">Salvar</button>
</div>

<!-- REGISTRAR PAGAMENTO -->
<div id="pagar" class="screen hide" style="position:relative;">
<h2>Registrar pagamento</h2>
<input id="clienteSearch" placeholder="Nome do cliente" oninput="mostrarSugestoes()">
<div id="sugestoes" class="suggestion-list hide"></div>
<input id="valorPag" type="number" placeholder="Valor pago" required>
<input id="dataPag" type="date" required>
<textarea id="obsPag" placeholder="Observações"></textarea>
<button onclick="registrarPagamento()">Registrar</button>
</div>

<!-- CONFIG -->
<div id="config" class="screen hide">
<h2>Configurações</h2>
<div class="card">
<button onclick="toggleCred()">Alterar login e senha</button>
<div id="cred" class="hide">
<input id="newUser" placeholder="Novo usuário">
<input id="newPass" type="password" placeholder="Nova senha">
<button onclick="alterarLogin()">Salvar</button>
</div>
</div>
<div class="card">
<button onclick="toggleDarkConfig()">Modo noturno</button>
<div id="darkCfg" class="hide">
<label><input type="checkbox" onchange="toggleDark(this)"> Ativar modo noturno</label>
</div>
</div>
</div>
</div>

<!-- NAV -->
<div class="nav hide" id="navBar">
<button onclick="show('panorama')">Panorama geral</button>
<button onclick="show('clientes')">Clientes</button>
<button onclick="show('add')">Adicionar</button>
<button onclick="show('pagar')">Registrar pagamento</button>
<button onclick="show('config')">Configurações</button>
</div>

<script>
let usuario = 'admin';
let senha = '123';
let clientes = JSON.parse(localStorage.getItem('clientes')) || [];

function login(){
 if(username.value.trim() === usuario && password.value.trim() === senha){
  loginMsg.innerText='';
  loginDiv.classList.add('hide');
  appDiv.classList.remove('hide');
  navBar.classList.remove('hide');
  atualizar();
 } else {
  loginMsg.innerText='Usuário ou senha incorretos';
 }
}

function show(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.add('hide')); document.getElementById(id).classList.remove('hide'); atualizar(); }

function salvarCliente(){
 if(!nome.value||!valor.value||!dataEmp.value||!dataLim.value) return alert('Preencha os campos obrigatórios');
 clientes.push({nome:nome.value,valor:+valor.value,dataEmp:dataEmp.value,dataLim:dataLim.value,obs:obs.value,pago:0});
 localStorage.setItem('clientes',JSON.stringify(clientes)); nome.value=valor.value=obs.value=''; atualizar(); show('clientes');
}

function calcular(c){
 let hoje=new Date(); let lim=new Date(c.dataLim);
 let atraso=Math.max(0,Math.floor((hoje-lim)/(1000*60*60*24)));
 return atraso*10;
}

function atualizar(){
 let te=0,tr=0,tp=0;
 lista.innerHTML='';
 clientes.forEach((c,i)=>{
  let multa=calcular(c);
  let dev=c.valor-c.pago+multa;
  te+=c.valor; tr+=dev; tp+=c.pago;

  let d=document.createElement('div'); d.className='card';
  d.innerHTML=`<strong>${c.nome}</strong>${dev<=0?' (Quitado)':''}<br>Emprestado: R$ ${c.valor} | Devedor: R$ ${Math.max(0,dev)}`;
  d.onclick=()=>alert(`Cliente: ${c.nome}\nEmprestado: ${c.valor}\nPago: ${c.pago}\nMulta: ${multa}\nObs: ${c.obs}`);
  lista.appendChild(d);
 });
 totEmp.innerText=te.toFixed(2);
 totRec.innerText=tr.toFixed(2);
 totPago.innerText=tp.toFixed(2);
 lucro.innerText=(tp-te).toFixed(2);
}

function filtrar(v){ document.querySelectorAll('#lista .card').forEach(c=>c.style.display=c.innerText.toLowerCase().includes(v.toLowerCase())?'':'none'); }

function mostrarSugestoes(){
  sugestoes.innerHTML='';
  const val = clienteSearch.value.toLowerCase();
  if(!val){ sugestoes.classList.add('hide'); return; }
  const matches = clientes.filter(c=>c.nome.toLowerCase().includes(val) && c.valor-c.pago+calcular(c) > 0);
  matches.forEach((c,i)=>{
    const div = document.createElement('div');
    div.className='suggestion-item';
    div.innerText=c.nome;
    div.onclick=()=>{
      clienteSearch.value=c.nome;
      sugestoes.classList.add('hide');
    };
    sugestoes.appendChild(div);
  });
  if(matches.length>0) sugestoes.classList.remove('hide');
}

function registrarPagamento(){
 const cliente = clientes.find(c => c.nome === clienteSearch.value);
 if(!cliente || !valorPag.value || !dataPag.value) return alert('Preencha os campos corretamente');
 cliente.pago += +valorPag.value;
 localStorage.setItem('clientes', JSON.stringify(clientes));
 valorPag.value = obsPag.value = clienteSearch.value = '';
 sugestoes.classList.add('hide');
 atualizar(); show('clientes');
}

function toggleCred(){ cred.classList.toggle('hide'); }
function alterarLogin(){ if(!newUser.value || !newPass.value) return alert('Preencha usuário e senha'); usuario = newUser.value.trim(); senha = newPass.value.trim(); newUser.value = newPass.value = ''; alert('Login alterado com sucesso'); }
function toggleDark(el){ document.body.style.background=el.checked?'#121212':'#e3f2fd'; document.body.style.color=el.checked?'#fff':'#333'; }
function toggleDarkConfig(){ darkCfg.classList.toggle('hide'); }
</script>
</body>
</html>